"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["616"],{2010:function(e,t,i){i.r(t),i.d(t,{APIKeys:()=>O,APIKeysPage:()=>E});var a=i(9109),o=i(3531),r=i(3799),n=i(9144),l=i(903),s=i(1576),c=i(9888),d=i(9805),p=i(2672),u=i(1319),y=i(7691),h=i(4174),m=i(1217),x=i(9626),K=i(3009),_=i(2464),g=i(2156);let Z=({apiKeyID:e,enabled:t})=>{let i=(0,r.cL)();return(0,x.default)(t?["api-key-secret",e]:null,()=>i.apiKeys.getSecret(e))},f=({apiKeyID:e})=>{let[t,i]=(0,n.useState)(!1),{data:o}=Z({apiKeyID:e,enabled:t}),{onCopy:r,hasCopied:l}=(0,_.VP)(o??"");return(0,n.useEffect)(()=>{t&&o&&(r(),i(!1))},[t,o,r]),(0,a.tZ)(c.Button,{variant:"ghost","aria-label":l?"Copied API key to clipboard":"Copy API key",onClick:()=>i(!0),focusRing:!1,elementDescriptor:c.descriptors.apiKeysCopyButton,children:(0,a.tZ)(c.Icon,{size:"sm",icon:l?h.Jr:h.uU,sx:e=>({color:e.colors.$primary500})})})},b=({apiKeyID:e})=>{let[t,i]=(0,n.useState)(!1),{data:o}=Z({apiKeyID:e,enabled:t});return(0,a.BX)(c.Flex,{center:!0,sx:{width:"100%",position:"relative"},children:[(0,a.tZ)(c.Input,{type:t?"text":"password",value:t&&o?o:`â€¢`.repeat(25),readOnly:!0,"aria-label":"API key (hidden)",sx:e=>({paddingInlineEnd:e.sizes.$12})}),(0,a.tZ)(c.Button,{variant:"ghost",sx:e=>({position:"absolute",right:0,"&:focus-visible":{...m.common.focusRingStyles(e)}}),focusRing:!1,"aria-label":"Show key",elementDescriptor:c.descriptors.apiKeysRevealButton,onClick:()=>i(!t),children:(0,a.tZ)(c.Icon,{icon:t?h.N6:h.bA,sx:e=>({color:e.colors.$colorTextSecondary})})})]})},D=({rows:e,isLoading:t,onRevoke:i,elementDescriptor:o})=>(0,a.tZ)(c.Flex,{sx:e=>({width:"100%",[m.mqu.sm]:{overflowX:"auto",padding:e.space.$0x25}}),children:(0,a.BX)(c.Table,{sx:e=>({background:e.colors.$colorBackground}),elementDescriptor:o,children:[(0,a.tZ)(c.Thead,{children:(0,a.BX)(c.Tr,{children:[(0,a.tZ)(c.Th,{children:"Name"}),(0,a.tZ)(c.Th,{children:"Last used"}),(0,a.tZ)(c.Th,{children:"Key"}),(0,a.tZ)(c.Th,{children:"Actions"})]})}),(0,a.tZ)(c.Tbody,{children:t?(0,a.tZ)(c.Tr,{children:(0,a.tZ)(c.Td,{colSpan:4,children:(0,a.tZ)(c.Spinner,{colorScheme:"primary",sx:{margin:"auto",display:"block"},elementDescriptor:c.descriptors.spinner})})}):e.length?e.map(e=>(0,a.BX)(c.Tr,{children:[(0,a.tZ)(c.Td,{children:(0,a.BX)(c.Flex,{direction:"col",sx:{minWidth:"25ch"},children:[(0,a.tZ)(c.Text,{variant:"subtitle",truncate:!0,children:e.name}),(0,a.tZ)(c.Text,{variant:"caption",colorScheme:"secondary",localizationKey:e.expiration?(0,c.localizationKeys)("apiKeys.createdAndExpirationStatus__expiresOn",{createdDate:e.createdAt,expiresDate:e.expiration}):(0,c.localizationKeys)("apiKeys.createdAndExpirationStatus__never",{createdDate:e.createdAt})})]})}),(0,a.tZ)(c.Td,{children:(0,a.tZ)(c.Box,{sx:{minWidth:"10ch"},children:(0,a.tZ)(c.Text,{localizationKey:e.lastUsedAt?(0,g.S)(e.lastUsedAt):"-"})})}),(0,a.tZ)(c.Td,{children:(0,a.BX)(c.Flex,{direction:"row",gap:1,sx:{[m.mqu.sm]:{minWidth:"25ch"}},children:[(0,a.tZ)(b,{apiKeyID:e.id}),(0,a.tZ)(f,{apiKeyID:e.id})]})}),(0,a.tZ)(c.Td,{children:(0,a.tZ)(K.a,{actions:[{label:(0,c.localizationKeys)("apiKeys.menuAction__revoke"),isDestructive:!0,onClick:()=>i(e.id,e.name)}]})})]},e.id)):(0,a.tZ)(v,{})})]})}),v=()=>(0,a.tZ)(c.Tr,{children:(0,a.tZ)(c.Td,{colSpan:4,children:(0,a.tZ)(c.Text,{localizationKey:(0,c.localizationKeys)("apiKeys.detailsTitle__emptyRow"),sx:{margin:"auto",display:"block",width:"fit-content"}})})});var C=i(4709),T=i(431),w=i(9460),F=i(8487),S=i(3146),z=i(6788);let I=["never","1d","7d","30d","60d","90d","180d","1y"],k={"1d":e=>e.setDate(e.getDate()+1),"7d":e=>e.setDate(e.getDate()+7),"30d":e=>e.setDate(e.getDate()+30),"60d":e=>e.setDate(e.getDate()+60),"90d":e=>e.setDate(e.getDate()+90),"180d":e=>e.setDate(e.getDate()+180),"1y":e=>e.setFullYear(e.getFullYear()+1)},B=e=>{switch(e){case"never":return"apiKeys.formFieldOption__expiration__never";case"1d":return"apiKeys.formFieldOption__expiration__1d";case"7d":return"apiKeys.formFieldOption__expiration__7d";case"30d":return"apiKeys.formFieldOption__expiration__30d";case"60d":return"apiKeys.formFieldOption__expiration__60d";case"90d":return"apiKeys.formFieldOption__expiration__90d";case"180d":return"apiKeys.formFieldOption__expiration__180d";case"1y":return"apiKeys.formFieldOption__expiration__1y"}},A=e=>{if("never"===e||!e)return;let t=new Date,i=new Date(t);return k[e](i),Math.floor((i.getTime()-t.getTime())/1e3)},P=({selectedExpiration:e,setSelectedExpiration:t})=>{let i=(0,n.useRef)(null),{t:o}=(0,c.useLocalizations)(),r=I.map(e=>({value:e,label:o((0,c.localizationKeys)(B(e)))}));return(0,a.BX)(S.Ph,{elementId:"apiKeyExpiration",options:r,value:e?.value??"",onChange:t,placeholder:o((0,c.localizationKeys)("formFieldInputPlaceholder__apiKeyExpirationDate")),referenceElement:i,children:[(0,a.tZ)(S.UN,{ref:i,icon:h.jC,sx:e=>({justifyContent:"space-between",backgroundColor:e.colors.$colorBackground}),"aria-labelledby":"expiration-field",id:"expiration-field"}),(0,a.tZ)(S.pp,{sx:e=>({paddingBlock:e.space.$1,color:e.colors.$colorText})})]})},R=({onCreate:e,isSubmitting:t})=>{let[i,o]=(0,n.useState)(null),{close:r}=(0,C.XC)(),{showDescription:l=!1}=(0,s.useApiKeysContext)(),{t:d}=(0,c.useLocalizations)(),p=(0,z.Yp)("name","",{type:"text",label:(0,c.localizationKeys)("formFieldLabel__apiKeyName"),placeholder:(0,c.localizationKeys)("formFieldInputPlaceholder__apiKeyName"),isRequired:!0}),u=(0,z.Yp)("apiKeyDescription","",{type:"text",label:(0,c.localizationKeys)("formFieldLabel__apiKeyDescription"),placeholder:(0,c.localizationKeys)("formFieldInputPlaceholder__apiKeyDescription"),isRequired:!1}),y=p.value.length>2,h=(0,n.useMemo)(()=>{let e=A(i?.value);if(!i?.value||!e)return d((0,c.localizationKeys)("apiKeys.formFieldCaption__expiration__never"));let t=new Date(Date.now()+1e3*e);return d((0,c.localizationKeys)("apiKeys.formFieldCaption__expiration__expiresOn",{date:t.toLocaleString(void 0,{year:"numeric",month:"long",day:"2-digit",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0,timeZoneName:"short"})}))},[i?.value]);return(0,a.tZ)(F.Y,{headerTitle:(0,c.localizationKeys)("apiKeys.formTitle"),headerSubtitle:(0,c.localizationKeys)("apiKeys.formHint"),elementDescriptor:c.descriptors.apiKeysCreateForm,children:(0,a.BX)(T.l.Root,{onSubmit:t=>{t.preventDefault(),e({name:p.value,description:u.value||void 0,secondsUntilExpiration:A(i?.value)},r)},children:[(0,a.BX)(c.Box,{sx:e=>({gap:e.space.$4,display:"flex",flexDirection:"row",[m.mqu.sm]:{flexDirection:"column"}}),children:[(0,a.tZ)(T.l.ControlRow,{sx:{flex:1},elementId:p.id,elementDescriptor:c.descriptors.apiKeysCreateFormNameInput,children:(0,a.tZ)(T.l.PlainInput,{...p.props})}),(0,a.BX)(c.Col,{sx:{flex:1,width:"100%"},gap:2,elementDescriptor:c.descriptors.apiKeysCreateFormExpirationInput,children:[(0,a.BX)(c.FormLabel,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexDirection:"row"},htmlFor:"expiration-field",children:[(0,a.tZ)(c.Text,{as:"span",variant:"subtitle",localizationKey:(0,c.localizationKeys)("formFieldLabel__apiKeyExpiration")}),(0,a.tZ)(c.Text,{variant:"caption",colorScheme:"secondary",localizationKey:(0,c.localizationKeys)("formFieldHintText__optional")})]}),(0,a.tZ)(P,{selectedExpiration:i,setSelectedExpiration:o}),(0,a.tZ)(c.Text,{variant:"caption",colorScheme:"secondary",localizationKey:h,elementDescriptor:c.descriptors.apiKeysCreateFormExpirationCaption})]})]}),l&&(0,a.tZ)(c.Col,{sx:e=>({borderTopWidth:e.borderWidths.$normal,borderTopStyle:e.borderStyles.$solid,borderTopColor:e.colors.$neutralAlpha100,paddingTop:e.space.$4,paddingBottom:e.space.$4}),children:(0,a.tZ)(T.l.ControlRow,{elementId:u.id,elementDescriptor:c.descriptors.apiKeysCreateFormDescriptionInput,children:(0,a.tZ)(T.l.PlainInput,{...u.props})})}),(0,a.tZ)(w.A,{submitLabel:(0,c.localizationKeys)("apiKeys.formButtonPrimary__add"),isDisabled:!y,onReset:r,isLoading:t,elementDescriptor:c.descriptors.apiKeysCreateFormSubmitButton})]})})},L=({subject:e,perPage:t=5})=>{let i=(0,r.cL)(),a={key:"api-keys",subject:e},{data:o,isLoading:l,mutate:s}=(0,x.default)(a,()=>i.apiKeys.getAll({subject:e})),[c,d]=(0,n.useState)(""),{page:p,setPage:u,pageCount:y,itemCount:h,startingRow:m,endingRow:K,paginatedItems:_}=X((o??[]).filter(e=>e.name.toLowerCase().includes(c.toLowerCase())),t);return{apiKeys:_,cacheKey:a,mutate:s,isLoading:l,search:c,setSearch:d,page:p,setPage:u,pageCount:y,itemCount:h,startingRow:m,endingRow:K}},X=(e,t)=>{let[i,a]=(0,n.useState)(1),o=e.length,r=Math.max(1,Math.ceil(o/t)),l=o>0?(i-1)*t+1:0,s=Math.min(i*t,o),c=e.slice(l-1,s);return{page:i,setPage:a,pageCount:r,itemCount:o,startingRow:l,endingRow:s,paginatedItems:c}},$=(0,n.lazy)(()=>i.e("642").then(i.bind(i,3250)).then(e=>({default:e.RevokeAPIKeyConfirmationModal}))),E=({subject:e,perPage:t,revokeModalRoot:i})=>{let{apiKeys:s,isLoading:x,search:K,setSearch:_,page:g,setPage:Z,pageCount:f,itemCount:b,startingRow:v,endingRow:C,cacheKey:T}=L({subject:e,perPage:t}),w=(0,p.useCardState)(),{trigger:F,isMutating:S}=(0,l.Z)(T,(e,{arg:t})=>I.apiKeys.create(t)),{t:z}=(0,c.useLocalizations)(),I=(0,r.cL)(),[k,B]=(0,n.useState)(!1),[A,P]=(0,n.useState)(""),[X,E]=(0,n.useState)(""),O=async(t,i)=>{try{await F({...t,subject:e}),i(),w.setError(void 0)}catch(e){(0,o.kD)(e)&&409===e.status&&w.setError("API Key name already exists")}};return(0,a.BX)(c.Col,{gap:4,sx:{width:"100%"},elementDescriptor:c.descriptors.apiKeys,children:[(0,a.BX)(d.a.Root,{children:[(0,a.BX)(c.Flex,{justify:"between",align:"center",gap:4,sx:{[m.mqu.sm]:{flexDirection:"column",alignItems:"stretch"}},elementDescriptor:c.descriptors.apiKeysHeader,children:[(0,a.tZ)(c.Box,{elementDescriptor:c.descriptors.apiKeysSearchBox,children:(0,a.tZ)(u.W,{placeholder:z((0,c.localizationKeys)("apiKeys.action__search")),leftIcon:(0,a.tZ)(c.Icon,{icon:h.Yt}),value:K,onChange:e=>{_(e.target.value),Z(1)},elementDescriptor:c.descriptors.apiKeysSearchInput})}),(0,a.tZ)(d.a.Trigger,{value:"add-api-key",hideOnActive:!1,children:(0,a.tZ)(c.Button,{variant:"solid",localizationKey:(0,c.localizationKeys)("apiKeys.action__add"),elementDescriptor:c.descriptors.apiKeysAddButton})})]}),(0,a.tZ)(d.a.Open,{value:"add-api-key",children:(0,a.tZ)(c.Flex,{sx:e=>({paddingTop:e.space.$6,paddingBottom:e.space.$6}),children:(0,a.tZ)(d.a.Card,{sx:{width:"100%"},children:(0,a.tZ)(R,{onCreate:O,isSubmitting:S})})})})]}),(0,a.tZ)(D,{rows:s,isLoading:x,onRevoke:(e,t)=>{P(e),E(t),B(!0)},elementDescriptor:c.descriptors.apiKeysTable}),b>(t??5)&&(0,a.tZ)(y.t,{count:f,page:g,onChange:Z,siblingCount:1,rowInfo:{allRowsCount:b,startingRow:v,endingRow:C}}),(0,a.tZ)($,{subject:e,isOpen:k,onOpen:()=>B(!0),onClose:()=>{P(""),E(""),B(!1)},apiKeyId:A,apiKeyName:X,modalRoot:i})]})},O=(0,s.withCoreUserGuard)((0,p.withCardStateProvider)(()=>{let e=(0,s.useApiKeysContext)(),{user:t}=(0,r.aF)(),{organization:i}=(0,r.o8)(),o=i?.id??t?.id??"";return(0,a.tZ)(c.Flow.Root,{flow:"apiKeys",sx:{width:"100%"},children:(0,a.tZ)(E,{subject:o,perPage:e.perPage})})}))}}]);